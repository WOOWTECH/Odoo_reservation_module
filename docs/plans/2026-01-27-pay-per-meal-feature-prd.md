# PRD: é¤é»çµä»˜æ¬¾åŠŸèƒ½ (Pay per Meal)

## æ¦‚è¿°

### å•é¡Œ
ç›®å‰é¸æ“‡ã€Œé¤é»çµã€æ¨¡å¼æ™‚ï¼Œæœƒé¡¯ç¤º Odoo Enterprise ä»˜æ¬¾é é¢ï¼Œç„¡æ³•ä½¿ç”¨ã€‚

### è§£æ±ºæ–¹æ¡ˆ
å¯¦ä½œè‡ªè¨‚ä»˜æ¬¾æµç¨‹ï¼Œç¹éä¼æ¥­ç‰ˆé™åˆ¶ï¼š
- æœ‰ç·šä¸Šæ”¯ä»˜è¨­å®š â†’ å°å‘ç·šä¸Šæ”¯ä»˜
- ç„¡ç·šä¸Šæ”¯ä»˜è¨­å®š â†’ é¡¯ç¤ºã€Œè«‹è‡³æ«ƒå°ä»˜æ¬¾ã€

### ç›®æ¨™ç”¨æˆ¶
ä½¿ç”¨è‡ªåŠ©é»é¤çš„é¤å»³é¡§å®¢

---

## æµç¨‹è¨­è¨ˆ

### é¤é»çµæ¨¡å¼æµç¨‹

```
é»é¤ â†’ è³¼ç‰©è»Š â†’ é€å‡ºè¨‚å–® â†’ ä»˜æ¬¾é é¢
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                   â†“
              æœ‰ç·šä¸Šæ”¯ä»˜           ç„¡ç·šä¸Šæ”¯ä»˜
                    â†“                   â†“
              ç·šä¸Šä»˜æ¬¾é é¢      ã€Œè«‹è‡³æ«ƒå°ä»˜æ¬¾ã€é é¢
                    â†“                   â†“
              ä»˜æ¬¾æˆåŠŸ              ç¢ºèªå®Œæˆ
                    â†“                   â†“
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                      ä»˜æ¬¾æˆåŠŸç¢ºèªé 
                    ã€Œå†é»ä¸€ä»½ã€æŒ‰éˆ•
```

---

## é é¢è¨­è¨ˆ

### 1. ä»˜æ¬¾é é¢ - æœ‰ç·šä¸Šæ”¯ä»˜æ™‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  ä»˜æ¬¾                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  è¨‚å–®æ‘˜è¦                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ä¹³é…ªæ¼¢å ¡ x1          NT$ 14    â”‚
â”‚  å¯å£å¯æ¨‚ x1          NT$ 2     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ç¸½è¨ˆ                 NT$ 16    â”‚
â”‚                                 â”‚
â”‚  é¸æ“‡ä»˜æ¬¾æ–¹å¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ’³ ä¿¡ç”¨å¡ / Stripe     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“± Line Pay            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½èªªæ˜ï¼š**
- é¡¯ç¤ºè¨‚å–®æ‘˜è¦å’Œç¸½é‡‘é¡
- åˆ—å‡ºæ‰€æœ‰å·²è¨­å®šçš„ç·šä¸Šæ”¯ä»˜æ–¹å¼
- é»æ“Šä»˜æ¬¾æ–¹å¼å¾Œè·³è½‰åˆ°å°æ‡‰çš„æ”¯ä»˜æµç¨‹

### 2. ä»˜æ¬¾é é¢ - ç„¡ç·šä¸Šæ”¯ä»˜æ™‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  ä»˜æ¬¾                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚         ğŸ§¾                      â”‚
â”‚                                 â”‚
â”‚     è«‹è‡³æ«ƒå°ä»˜æ¬¾                â”‚
â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  è¨‚å–®ç·¨è™Ÿ: #00003-001-0014      â”‚
â”‚  ç¸½è¨ˆ: NT$ 16                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                 â”‚
â”‚  è«‹å‡ºç¤ºæ­¤ç•«é¢çµ¦æœå‹™äººå“¡         â”‚
â”‚                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚      æˆ‘å·²å®Œæˆä»˜æ¬¾       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½èªªæ˜ï¼š**
- é¡¯ç¤ºè¨‚å–®ç·¨è™Ÿå’Œç¸½é‡‘é¡
- æç¤ºå®¢æˆ¶å‡ºç¤ºç•«é¢çµ¦æœå‹™äººå“¡
- ã€Œæˆ‘å·²å®Œæˆä»˜æ¬¾ã€æŒ‰éˆ• â†’ å°å‘ä»˜æ¬¾æˆåŠŸé 

### 3. ä»˜æ¬¾æˆåŠŸç¢ºèªé 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚            âœ“                    â”‚
â”‚                                 â”‚
â”‚       ä»˜æ¬¾æˆåŠŸï¼                â”‚
â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  è¨‚å–®ç·¨è™Ÿ: #00003-001-0014      â”‚
â”‚  ä»˜æ¬¾é‡‘é¡: NT$ 16               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                 â”‚
â”‚     æ„Ÿè¬æ‚¨çš„æƒ é¡§                â”‚
â”‚     é¤é»æº–å‚™ä¸­ï¼Œè«‹ç¨å€™          â”‚
â”‚                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚       å†é»ä¸€ä»½          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½èªªæ˜ï¼š**
- é¡¯ç¤ºä»˜æ¬¾æˆåŠŸè¨Šæ¯
- é¡¯ç¤ºè¨‚å–®ç·¨è™Ÿå’Œä»˜æ¬¾é‡‘é¡
- ã€Œå†é»ä¸€ä»½ã€æŒ‰éˆ• â†’ è¿”å›é¦–é é–‹å§‹æ–°è¨‚å–®

---

## æŠ€è¡“è¦æ ¼

### éœ€è¦æ–°å¢/ä¿®æ”¹çš„æª”æ¡ˆ

| æª”æ¡ˆ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `static/src/app/pages/payment_page/payment_page.js` | æ–°å¢ | ä»˜æ¬¾é é¢é‚è¼¯ |
| `static/src/app/pages/payment_page/payment_page.xml` | æ–°å¢ | ä»˜æ¬¾é é¢æ¨¡æ¿ |
| `static/src/app/pages/payment_success_page/payment_success_page.js` | æ–°å¢ | ä»˜æ¬¾æˆåŠŸé é‚è¼¯ |
| `static/src/app/pages/payment_success_page/payment_success_page.xml` | æ–°å¢ | ä»˜æ¬¾æˆåŠŸé æ¨¡æ¿ |
| `static/src/app/pages/confirmation_page/confirmation_page.js` | ä¿®æ”¹ | é¤é»çµæ™‚å°å‘ä»˜æ¬¾é  |
| `i18n/zh_TW.po` | ä¿®æ”¹ | æ–°å¢ç¿»è­¯å­—ä¸² |

### è·¯ç”±è¨­è¨ˆ

| è·¯ç”± | é é¢ | èªªæ˜ |
|------|------|------|
| `/pos-self/:id/payment` | PaymentPage | ä»˜æ¬¾é é¢ |
| `/pos-self/:id/payment_success` | PaymentSuccessPage | ä»˜æ¬¾æˆåŠŸé  |

### é‚è¼¯åˆ¤æ–·

```javascript
// åˆ¤æ–·æ˜¯å¦æœ‰ç·šä¸Šæ”¯ä»˜è¨­å®š
get hasOnlinePayment() {
    const onlinePaymentMethods = this.selfOrder.config.self_ordering_online_payment_method_id;
    return onlinePaymentMethods && onlinePaymentMethods.length > 0;
}

// åˆ¤æ–·æ˜¯å¦ç‚ºé¤é»çµæ¨¡å¼
get isPayPerMeal() {
    return this.selfOrder.config.self_ordering_pay_after === 'meal';
}
```

### ä»˜æ¬¾æµç¨‹é‚è¼¯

```javascript
// PaymentPage
async processPayment(paymentMethodId) {
    if (this.hasOnlinePayment) {
        // å°å‘ç·šä¸Šæ”¯ä»˜æµç¨‹
        await this.selfOrder.processOnlinePayment(paymentMethodId);
    } else {
        // ç„¡ç·šä¸Šæ”¯ä»˜ï¼Œç­‰å¾…æ«ƒå°ç¢ºèª
        // ã€Œæˆ‘å·²å®Œæˆä»˜æ¬¾ã€æŒ‰éˆ•è§¸ç™¼
        await this.markAsPaid();
    }
    this.router.navigate("payment_success");
}

// PaymentSuccessPage
orderAgain() {
    // æ¸…é™¤ç•¶å‰è¨‚å–®ç‹€æ…‹
    this.selfOrder.resetOrder();
    // è¿”å›é¦–é 
    this.router.navigate("landing");
}
```

---

## ç¿»è­¯å­—ä¸²

| è‹±æ–‡ | ç¹é«”ä¸­æ–‡ |
|------|---------|
| Payment | ä»˜æ¬¾ |
| Order Summary | è¨‚å–®æ‘˜è¦ |
| Total | ç¸½è¨ˆ |
| Select Payment Method | é¸æ“‡ä»˜æ¬¾æ–¹å¼ |
| Credit Card | ä¿¡ç”¨å¡ |
| Please pay at counter | è«‹è‡³æ«ƒå°ä»˜æ¬¾ |
| Order Number | è¨‚å–®ç·¨è™Ÿ |
| Show this screen to staff | è«‹å‡ºç¤ºæ­¤ç•«é¢çµ¦æœå‹™äººå“¡ |
| I have completed payment | æˆ‘å·²å®Œæˆä»˜æ¬¾ |
| Payment Successful | ä»˜æ¬¾æˆåŠŸ |
| Payment Amount | ä»˜æ¬¾é‡‘é¡ |
| Thank you for your patronage | æ„Ÿè¬æ‚¨çš„æƒ é¡§ |
| Your meal is being prepared | é¤é»æº–å‚™ä¸­ï¼Œè«‹ç¨å€™ |
| Order Again | å†é»ä¸€ä»½ |

---

## å¯¦ä½œæ­¥é©Ÿ

### éšæ®µä¸€ï¼šä»˜æ¬¾é é¢
1. å»ºç«‹ `payment_page.js` - ä»˜æ¬¾é é¢çµ„ä»¶
2. å»ºç«‹ `payment_page.xml` - ä»˜æ¬¾é é¢æ¨¡æ¿
3. è¨»å†Šè·¯ç”± `/payment`
4. å¯¦ä½œç·šä¸Šæ”¯ä»˜åˆ¤æ–·é‚è¼¯
5. å¯¦ä½œã€Œè«‹è‡³æ«ƒå°ä»˜æ¬¾ã€UI

### éšæ®µäºŒï¼šä»˜æ¬¾æˆåŠŸé 
1. å»ºç«‹ `payment_success_page.js` - ä»˜æ¬¾æˆåŠŸé çµ„ä»¶
2. å»ºç«‹ `payment_success_page.xml` - ä»˜æ¬¾æˆåŠŸé æ¨¡æ¿
3. è¨»å†Šè·¯ç”± `/payment_success`
4. å¯¦ä½œã€Œå†é»ä¸€ä»½ã€æŒ‰éˆ•é‚è¼¯

### éšæ®µä¸‰ï¼šæ•´åˆç¢ºèªé 
1. ä¿®æ”¹ `confirmation_page.js` - é¤é»çµæ¨¡å¼å°å‘ä»˜æ¬¾é 
2. ç¢ºä¿è¨‚å–®é€å‡ºå¾Œæ­£ç¢ºè·³è½‰

### éšæ®µå››ï¼šç¿»è­¯èˆ‡æ¸¬è©¦
1. æ›´æ–° `i18n/zh_TW.po` ç¿»è­¯æª”
2. æ¸¬è©¦æœ‰ç·šä¸Šæ”¯ä»˜çš„æµç¨‹
3. æ¸¬è©¦ç„¡ç·šä¸Šæ”¯ä»˜çš„æµç¨‹
4. æ¸¬è©¦ã€Œå†é»ä¸€ä»½ã€åŠŸèƒ½

---

## èˆ‡ç¾æœ‰åŠŸèƒ½çš„é—œä¿‚

### é¤é»çµ vs æ•´å–®çµ å°æ¯”

| åŠŸèƒ½ | é¤é»çµ (meal) | æ•´å–®çµ (each) |
|------|--------------|---------------|
| ä»˜æ¬¾æ™‚æ©Ÿ | æ¯æ¬¡é€å‡ºå¾Œç«‹å³ä»˜æ¬¾ | ç”¨é¤çµæŸå¾Œçµ±ä¸€ä»˜æ¬¾ |
| ç¢ºèªé é¡¯ç¤º | å°å‘ä»˜æ¬¾é  | é¡¯ç¤ºã€Œè¿”å›é¦–é ã€å’Œã€Œæˆ‘çš„è¨‚å–®ã€ |
| å¯å¤šæ¬¡é»é¤ | ä»˜æ¬¾å¾Œå¯ã€Œå†é»ä¸€ä»½ã€ | éš¨æ™‚å¯ç¹¼çºŒé»é¤ |
| è¨‚å–®ç®¡ç† | æ¯ç­†è¨‚å–®ç¨ç«‹ä»˜æ¬¾ | æ‰€æœ‰è¨‚å–®åˆä½µçµå¸³ |

### ç¢ºèªé æµç¨‹åˆ¤æ–·

```javascript
// confirmation_page.js
onOrderConfirmed() {
    if (this.isPayPerMeal) {
        // é¤é»çµï¼šå°å‘ä»˜æ¬¾é 
        this.router.navigate("payment");
    } else {
        // æ•´å–®çµï¼šé¡¯ç¤ºç¹¼çºŒé»é¤é¸é …
        // (ç¾æœ‰é‚è¼¯)
    }
}
```

---

## é¢¨éšªèˆ‡è€ƒé‡

### æŠ€è¡“é¢¨éšª

| é¢¨éšª | å½±éŸ¿ | ç·©è§£æªæ–½ |
|------|------|---------|
| ç·šä¸Šæ”¯ä»˜æ•´åˆè¤‡é›œ | å¯èƒ½ç„¡æ³•æ”¯æ´æ‰€æœ‰æ”¯ä»˜æ–¹å¼ | å…ˆå¯¦ä½œã€Œè«‹è‡³æ«ƒå°ä»˜æ¬¾ã€ï¼Œç·šä¸Šæ”¯ä»˜ä½œç‚ºé€²éšåŠŸèƒ½ |
| ä»˜æ¬¾ç‹€æ…‹åŒæ­¥ | æ«ƒå°ä»˜æ¬¾å¾Œç‹€æ…‹æœªæ›´æ–° | è¨‚å–®ç‹€æ…‹ç”± POS å¾Œå°ç®¡ç† |

### æ¥­å‹™è€ƒé‡

| è€ƒé‡ | èªªæ˜ |
|------|------|
| æ«ƒå°ä»˜æ¬¾é©—è­‰ | ã€Œæˆ‘å·²å®Œæˆä»˜æ¬¾ã€ä¾è³´å®¢æˆ¶èª ä¿¡ï¼Œå»ºè­°æœå‹™äººå“¡æ ¸å°è¨‚å–®ç·¨è™Ÿ |
| ç·šä¸Šæ”¯ä»˜æ‰‹çºŒè²» | ç·šä¸Šæ”¯ä»˜æœƒç”¢ç”Ÿæ‰‹çºŒè²»ï¼Œåº—å®¶éœ€è‡ªè¡Œè©•ä¼° |

---

## æˆåŠŸæŒ‡æ¨™

1. **åŠŸèƒ½å®Œæ•´æ€§**ï¼šé¤é»çµæ¨¡å¼èƒ½æ­£å¸¸ä»˜æ¬¾
2. **ç„¡ä¼æ¥­ç‰ˆä¾è³´**ï¼šå®Œå…¨ç¹é Enterprise é™åˆ¶
3. **ä½¿ç”¨è€…é«”é©—**ï¼šä»˜æ¬¾æµç¨‹æ¸…æ™°ç›´è§€
4. **å½ˆæ€§**ï¼šæ”¯æ´æœ‰/ç„¡ç·šä¸Šæ”¯ä»˜å…©ç¨®æƒ…å¢ƒ
