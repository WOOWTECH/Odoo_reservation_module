<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- Extend ConfirmationPage for "Pay per Order" mode -->
    <t t-inherit="pos_self_order.ConfirmationPage" t-inherit-mode="extension">

        <!--
            In "Pay per Order" mode, replace the default action button
            with "Back to Home" and "My Orders" buttons.
        -->
        <xpath expr="//button[hasclass('btn-primary') and contains(@t-on-click, 'backToHome')]" position="replace">
            <t t-if="showPayPerMealUI">
                <!-- Pay per Meal mode: show payment button -->
                <div class="d-flex flex-column gap-3 w-100">
                    <p class="text-center text-muted mb-3">
                        餐點已送至廚房準備中<br/>
                        請前往付款頁面完成結帳
                    </p>
                    <button class="btn btn-lg btn-primary w-100" t-on-click="goToPayment">
                        <i class="fa fa-credit-card me-2"></i>
                        前往付款
                    </button>
                </div>
            </t>
            <t t-elif="showPayPerOrderUI">
                <!-- Pay per Order mode: show navigation buttons -->
                <div class="d-flex flex-column gap-3 w-100">
                    <p class="text-center text-muted mb-3">
                        餐點已送至廚房準備中<br/>
                        您可以繼續點餐或前往「我的訂單」統一結帳
                    </p>
                    <button class="btn btn-lg btn-primary w-100" t-on-click="goToLanding">
                        返回首頁
                    </button>
                    <button class="btn btn-lg btn-secondary w-100" t-on-click="goToMyOrders">
                        我的訂單
                    </button>
                </div>
            </t>
            <t t-else="">
                <!-- Default behavior: show original button -->
                <button class="btn btn-lg w-100"
                    t-att-class="{'btn-primary': screenMode == 'mobile', 'btn-secondary text-bg-secondary': screenMode == 'kiosk'}"
                    t-on-click="backToHome">
                    <t t-if="screenMode == 'kiosk'">關閉</t>
                    <t t-else="">確定</t>
                </button>
            </t>
        </xpath>

        <!--
            In "Pay per Order" mode, hide the payment instruction
            since customer will pay later.
        -->
        <xpath expr="//p[contains(@class, 'text-center') and contains(text(), 'amount')]" position="attributes">
            <attribute name="t-if">!showPayPerOrderUI and !showPayPerMealUI and confirmedOrder.amount_total > 0 and confirmedOrder.state != 'paid'</attribute>
        </xpath>

    </t>

</templates>
